name: CI

# Управление запуском рабочего процесса. 
# Триггерится по запросам push и pull в ветку master.
on:
#  push:
#    branches: [ master ]
#  pull_request:
#    branches: [ master, develop ]

  workflow_dispatch:
  
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  KEYSTORE_FILE: $ {{ secrets.KEYSTORE_FILE }}
  KEYSTORE_KEY_ALIAS: ${{ secrets.KEYSTORE_KEY_ALIAS }}
  KEYSTORE_KEY_PASSWORD: ${{ secrets.KEYSTORE_KEY_PASSWORD }}
  KEYSTORE_STORE_PASSWORD: ${{ secrets.KEYSTORE_STORE_PASSWORD }}

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Decode Keystore
        id: decode_keystore
        uses: timheuer/base64-to-file@v1
        with:
         fileName: 'config/keystore.jks'
         encodedString: KEYSTORE_FILE
      
      - uses: actions/checkout@v2
      
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
         java-version: 1.8
          
      - uses: eskatos/gradle-command-action@v1
        with:
         gradle-version: 6.7.1
         wrapper-cache-enabled: true
         dependencies-cache-enabled: true
         configuration-cache-enabled: true
#         arguments: assembleRelease appDistributionUploadTemplateRelease
          
      - name: Make Gradlew Executable
        run: chmod +x ./gradlew
        
#      - name: Run Unit Tests
#        run: ./gradlew test
        
#      - name: Build Debug APK
#        run: ./gradlew app:assembleDebug
          
#      - name: Upload Debug APK to Outputs
#        uses: actions/upload-artifact@v2
#        with:
#         name: Build Artifacts
#          path: |
#            app/build/outputs/apk
#            app/build/outputs/bundle

      - name: Expose version name
        uses: michpohl/android-expose-version-name-action@v1.0.0
        with:
         path: app/build.gradle
         expose-version-name: 'true'
         expose-version-code: 'true'
          
#      - name: Print Version
#      - run: |
#         echo VersionName ${{ env.ANDROID_VERSION_NAME }},
#         echo VersionCode ${{ env.ANDROID_VERSION_CODE }}.
          
#      - name: Create Release
#        id: create_release
#        uses: actions/create-release@v1
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#        with:
#          tag_name: ${{ github.ref }}
#          release_name: ${{ env.RELEASE_NAME }}
#          body: |
#            What is new :
#              - First Change
#              - Second Change
#          draft: false
#          prerelease: false
          
#      - name: Push Notification Message In Telegram
#        uses: appleboy/telegram-action@master
#        with:
#          to: ${{ secrets.TELEGRAM_BOT_ID }}
#         token: ${{ secrets.TELEGRAM_TOKEN }}
#          args: The ${{ github.event_name }} event triggered first step.
